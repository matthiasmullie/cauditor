<script src="/assets/js/vendor/d3.min.js"></script>
<script src="/assets/js/vendor/d3plus.min.js"></script>
<script src="/assets/js/Cauditor.js"></script>
<script src="/assets/js/visualizations/Data.js"></script>
<script src="/assets/js/visualizations/Abstract.js"></script>
<script src="/assets/js/visualizations/lineplot/Abstract.js"></script>
<script src="/assets/js/visualizations/lineplot/User.js"></script>

{% include 'utils/user_navbar.html' %}

{% if not user %}
    <div class="container">
        <div class="row">
            <div class="col-xs-12 columns">
                <div class="alert alert-danger" role="alert">
                    <i class="fa fa-exclamation-circle"></i>
                    You are not currently logged in. Please <a href="https://github.com/login/oauth/authorize?scope={{ github.scopes }}&client_id={{ github.id }}" class="alert-link">authenticate via GitHub</a>.
                </div>
            </div>
        </div>
    </div>
{% else %}
    {% if not settings.emails %}
        <div class="container">
            <div class="row">
                <div class="col-xs-12 columns">
                    <div class="alert alert-danger" role="alert">
                        <i class="fa fa-exclamation-circle"></i>
                        Couldn't find any commits for {{ user.name }}. Please <a href="/user/settings" class="alert-link">fill out your git author email addresses</a> to locate your commits.
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="chart"></div>

        <script>
            $.ajax({
                url: '/api/user/diffs',
                datatype: 'json',
                success: function(data) {
                    var data = new Cauditor.Data(data),
                        visualization = new Cauditor.Visualization.Lineplot.User(data),
                        chart = new Cauditor(visualization);

                    chart.draw('.chart', ['{{ chart.code }}', {{ chart.range }}]);
                }
            });
        </script>
    {% endif %}
{% endif %}
