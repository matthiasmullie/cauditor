{% include 'utils/user_navbar.html' %}

{% if not user %}
    <div class="container">
        <div class="row">
            <div class="col-xs-12 columns">
                <div class="alert alert-danger" role="alert">
                    <i class="fa fa-exclamation-circle"></i>
                    You are not currently logged in. Please <a href="https://github.com/login/oauth/authorize?scope={{ github.scopes }}&client_id={{ github.id }}" class="alert-link">authenticate via GitHub</a>.
                </div>
            </div>
        </div>
    </div>
{% else %}
    <script src="/assets/js/vendor/bootstrap-tagsinput.min.js"></script>
    <link rel="stylesheet" href="/assets/css/vendor/bootstrap-tagsinput.css">

    <div class="container">
        <div class="row">
            <form class="form-horizontal">
                <div class="form-group">
                    <label for="emails" class="col-sm-2">Git author email(s)</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="emails" name="emails" placeholder="name@example.com" value="{{ settings.emails }}" />
                    </div>
                    <div class="col-sm-offset-2 col-sm-10">
                        <small>
                            List the email addresses you've committed code with (<code>git config user.email</code>) to locate
                            your commits and <a href="/user/progress">get insights</a>.
                        </small>
                    </div>
                </div>
            </form>
        </div>

        <script>
            // email address multi-input field
            $('#emails').tagsinput({
                tagClass: 'label label-default',
                trimValue: true
            });
            $('#emails')
                .on('beforeItemAdd', function(event) {
                    var items = $(this).tagsinput('items').slice(0);
                    items.push(event.item);

                    $.ajax({
                        url: '/api/user/settings',
                        method: 'PUT',
                        data: JSON.stringify({ 'emails': items.join() })
                    }).fail(function() {
                        event.cancel;
                    });
                })
                .on('beforeItemRemove', function(event) {
                    var items = $(this).tagsinput('items').slice(0),
                        i = items.indexOf(event.item);
                    items.splice(i, 1);

                    $.ajax({
                        url: '/api/user/settings',
                        method: 'PUT',
                        data: JSON.stringify({ 'emails': items.join() })
                    }).fail(function() {
                        event.cancel;
                    });
                });
        </script>
    </div>
{% endif %}
